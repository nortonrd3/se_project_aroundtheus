!function(){"use strict";class e{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._formElement=t}_showInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_checkInputValidity(e){if(!e.validity.valid)return this._showInputError(e);this._hideInputError(e)}_toggleButtonState(e){this._hasInvalidInput(e)?this._disableButton():this._enableButton()}_hasInvalidInput(e){return e.some((e=>!e.validity.valid))}_setEventListeners(){const e=Array.from(this._formElement.querySelectorAll(this._inputSelector));this._submitButton=this._formElement.querySelector(this._submitButtonSelector),this._toggleButtonState(e),e.forEach((t=>{t.addEventListener("input",(()=>{this._checkInputValidity(t),this._toggleButtonState(e)}))}))}_disableButton(){this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0}_enableButton(){this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1}enableValidation(){this._formElement.addEventListener("submit",(e=>{e.preventDefault(),this._disableButton()})),this._setEventListeners()}}class t{constructor(e,t,s,r,i){this._name=e.name,this._link=e.link,this.id=e._id,this._isLiked=e.isLiked,this._cardSelector=t,this._handleImageClick=s,this._handleLikeIcon=r,this.handleDeleteCard=i}_setEventListeners(){this._cardElement.querySelector(".card__delete-button").addEventListener("click",(()=>{this.handleDeleteCard(this)})),this._cardElement.querySelector(".card__image").addEventListener("click",(()=>{this._handleImagePreview(this._name,this._link)})),this._cardElement.querySelector(".card__like-button").addEventListener("click",(()=>{this._handleLikeIcon(this)}))}_handleLikeIcon(){this._cardElement.querySelector(".card__like-button").classList.toggle("card__like-button_active")}_renderLikes(){this._isLiked?this._likeButton.classList.add("card__like-button_active"):this._likeButton.classList.remove("card__like-button_active")}handleLike(e){this._isLiked=e,this._renderLikes()}getCardId(){return this.id}getIsLiked(){return this._isLiked}remove(){this._cardElement.remove(),this._cardElement=null}_handleImagePreview(){this._handleImageClick(this._name,this._link)}getView(){return this._cardElement=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0),this._likeButton=this._cardElement.querySelector(".card__like-button"),this._cardImageElement=this._cardElement.querySelector(".card__image"),this._cardTitleElement=this._cardElement.querySelector(".card__title"),this._cardImageElement.src=this._link,this._cardImageElement.alt=this._name,this._cardTitleElement.textContent=this._name,this._setEventListeners(),this._renderLikes(this._isLiked),this._cardElement}}class s{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t),this._closeButton=this._popupElement.querySelector(".modal__close"),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._closeButton.addEventListener("click",(()=>this.close())),this._popupElement.addEventListener("click",(e=>{e.target.classList.contains("modal_opened")&&this.close()}))}}class r extends s{constructor(e){let{popupSelector:t,handleFormSubmit:s}=e;super({popupSelector:t}),this._popupForm=this._popupElement.querySelector(".modal__form"),this._handleFormSubmit=s,this._submitButton=this._popupForm.querySelector(".modal__button"),this._submitButtonText=this._submitButton.textContent,this._inputList=Array.from(this._popupForm.querySelectorAll(".modal__input"))}_getInputValues(){return this._popupFormValues={},this._inputList.forEach((e=>{this._popupFormValues[e.name]=e.value})),this._popupFormValues}setInputValues(e){this._inputList.forEach((t=>{t.value=e[t.name]}))}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues()),this._popupForm.reset()}))}renderLoadingText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitButton.textContent=e?t:this._submitButtonText}}class i{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}const n={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},o=document.querySelector("#profile-edit-button"),a=document.querySelector("#profile-edit-modal"),l=document.querySelector("#add-card-modal"),d=document.querySelector("#edit-avatar-modal"),c=document.querySelector("#profile-title-input"),h=document.querySelector("#profile-description-input"),u=a.querySelector(".modal__form"),_=l.querySelector(".modal__form"),m=document.querySelector(".profile__add-button"),p=document.querySelector(".profile__avatar-button"),E=d.querySelector(".modal__form");function S(e,t){w.open(e,t)}p.addEventListener("click",(()=>B.open())),o.addEventListener("click",(()=>{const e=v.getUserInfo();c.value=e.name,h.value=e.description,q.open()})),m.addEventListener("click",(()=>C.open()));const v=new class{constructor(e){let{nameSelector:t,jobSelector:s,avatarSelector:r}=e;this._name=document.querySelector(t),this._job=document.querySelector(s),this._avatar=document.querySelector(r)}getUserInfo(){return{name:this._name.textContent,description:this._job.textContent,avatar:this._avatar.src}}setUserInfo(e){this._name.textContent=e.title,this._job.textContent=e.description}updateAvatar(e){this._avatar.src=e}}({nameSelector:".profile__title",jobSelector:".profile__description",avatarSelector:".profile__image"}),b=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}_handlePromise(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._handlePromise)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._handlePromise)}getAllData(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}updateUserInfo(e){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.title,about:e.description})}).then(this._handlePromise)}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._handlePromise)}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"PUT",headers:this._headers}).then(this._handlePromise)}removeLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:"DELETE",headers:this._headers}).then(this._handlePromise)}addCard(e){let{name:t,link:s,_id:r}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s,_id:r})}).then(this._handlePromise)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._handlePromise)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"6f07cb37-e9a8-4f19-ad7e-e33ed7b58580","Content-Type":"application/json"}});let L;b.getAllData().then((e=>{let[t,s]=e;v.updateAvatar(s.avatar),v.setUserInfo({title:s.name,description:s.about}),L=new i({items:t,renderer:g},".cards__list"),L.renderItems()})).catch((e=>console.error(e)));const f=new e(n,_);f.enableValidation(),new e(n,u).enableValidation();const k=new e(n,E);k.enableValidation();const g=e=>{const s=function(e){return new t(e,"#card-template",S,y,I).getView()}(e);L.addItem(s)};function y(e){e.getIsLiked()?b.removeLike(e.getCardId()).then((()=>{e.handleLike(!1)})).catch((e=>{console.error(e)})):b.addLike(e.getCardId()).then((()=>{e.handleLike(!0)})).catch((e=>{console.error(e)}))}function I(e){x.open(),x.confirmDeletion((()=>{b.deleteCard(e.getCardId()).then((()=>{e.remove(),x.close()})).catch((e=>{console.error("Error deleting card",e)}))}))}const C=new r({popupSelector:"#add-card-modal",handleFormSubmit:function(e){C.renderLoadingText(!0),b.addCard({name:e.name,link:e.link,_id:e.id,isLiked:e.isLiked}).then((e=>{g(e),C.close(),_.reset(),f._disableButton()})).catch((e=>{console.error("Error while adding card",e)})).finally((()=>{C.renderLoadingText(!1)}))}});C.setEventListeners();const q=new r({popupSelector:"#profile-edit-modal",handleFormSubmit:function(e){q.renderLoadingText(!0),b.updateUserInfo(e).then((e=>{v.setUserInfo({title:e.name,description:e.about}),q.close()})).catch((e=>{console.error(e)})).finally((()=>{q.renderLoadingText(!1)}))}});q.setEventListeners();const B=new r({popupSelector:"#edit-avatar-modal",handleFormSubmit:function(e){B.renderLoadingText(!0),b.updateAvatar(e).then((e=>{v.updateAvatar(e.avatar),B.close(),E.reset(),k._disableButton()})).catch((e=>{console.error("Error updating avatar",e)})).finally((()=>{B.renderLoadingText(!1)}))}});B.setEventListeners();const w=new class extends s{constructor(e){let{popupSelector:t}=e;super({popupSelector:t}),this._image=this._popupElement.querySelector(".modal__card-image"),this._title=this._popupElement.querySelector(".modal__card-title")}open(e,t){this._title.textContent=e,this._image.alt=e,this._image.src=t,super.open()}}({popupSelector:"#preview-image-modal"});w.setEventListeners();const x=new class extends s{constructor(e){let{popupSelector:t,handleFormSubmit:s}=e;super({popupSelector:t}),this._handleFormSubmit=s,this._popup=document.querySelector(t),this._deleteButton=this._popupElement.querySelector(".card__delete-button"),this._isSubmitted=!1,this._cardId=null,this._card=null}open(e,t){this._card=e,this._cardId=t,super.open()}getIsSubmitted(){return this._isSubmitted}confirmDeletion(e){this._handleFormSubmit=e}setEventListeners(){super.setEventListeners(),this._popupElement.addEventListener("click",(e=>{e.preventDefault(),this._isSubmitted=!0,this._handleFormSubmit(this._card,this._cardId)}))}}({popupSelector:"#remove-card-modal",handleFormSubmit:()=>{}});x.setEventListeners()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWtCQSxTQUVwQnNHLEVBQXFCMUcsbUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXAuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy91dGlscy91dGlscy5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvVXNlckluZm8uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwQ29uZmlybURlbGV0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3Rvcihjb25maWcsIGZvcm1FbGVtZW50KSB7XG4gICAgdGhpcy5faW5wdXRTZWxlY3RvciA9IGNvbmZpZy5pbnB1dFNlbGVjdG9yO1xuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yO1xuICAgIHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MgPSBjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcztcbiAgICB0aGlzLl9pbnB1dEVycm9yQ2xhc3MgPSBjb25maWcuaW5wdXRFcnJvckNsYXNzO1xuICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBjb25maWcuZXJyb3JDbGFzcztcbiAgICB0aGlzLl9mb3JtRWxlbWVudCA9IGZvcm1FbGVtZW50O1xuICB9XG5cbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZCh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsZW1lbnQgPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXG4gICAgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xuICAgIGVycm9yTWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSBcIlwiO1xuICAgIGVycm9yTWVzc2FnZUVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcbiAgfVxuXG4gIF9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbGVtZW50KSB7XG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zaG93SW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICAgIH1cbiAgICB0aGlzLl9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpO1xuICB9XG5cbiAgX3RvZ2dsZUJ1dHRvblN0YXRlKGlucHV0RWxlbWVudHMpIHtcbiAgICBpZiAodGhpcy5faGFzSW52YWxpZElucHV0KGlucHV0RWxlbWVudHMpKSB7XG4gICAgICB0aGlzLl9kaXNhYmxlQnV0dG9uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2VuYWJsZUJ1dHRvbigpO1xuICAgIH1cbiAgfVxuXG4gIF9oYXNJbnZhbGlkSW5wdXQoaW5wdXRFbGVtZW50cykge1xuICAgIHJldHVybiBpbnB1dEVsZW1lbnRzLnNvbWUoKGlucHV0RWxlbWVudCkgPT4gIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCk7XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgY29uc3QgaW5wdXRFbGVtZW50cyA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXG4gICAgKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKFxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3JcbiAgICApO1xuICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKGlucHV0RWxlbWVudHMpO1xuICAgIGlucHV0RWxlbWVudHMuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgICAgdGhpcy5fY2hlY2tJbnB1dFZhbGlkaXR5KGlucHV0RWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKGlucHV0RWxlbWVudHMpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBfZGlzYWJsZUJ1dHRvbigpIHtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSB0cnVlO1xuICB9XG5cbiAgX2VuYWJsZUJ1dHRvbigpIHtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5fZGlzYWJsZUJ1dHRvbigpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2FyZCB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIGRhdGEsXG4gICAgY2FyZFNlbGVjdG9yLFxuICAgIGhhbmRsZUltYWdlQ2xpY2ssXG4gICAgaGFuZGxlTGlrZUljb24sXG4gICAgaGFuZGxlRGVsZXRlQ2FyZFxuICApIHtcbiAgICB0aGlzLl9uYW1lID0gZGF0YS5uYW1lO1xuICAgIHRoaXMuX2xpbmsgPSBkYXRhLmxpbms7XG4gICAgdGhpcy5pZCA9IGRhdGEuX2lkO1xuICAgIHRoaXMuX2lzTGlrZWQgPSBkYXRhLmlzTGlrZWQ7XG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sgPSBoYW5kbGVJbWFnZUNsaWNrO1xuICAgIHRoaXMuX2hhbmRsZUxpa2VJY29uID0gaGFuZGxlTGlrZUljb247XG4gICAgdGhpcy5oYW5kbGVEZWxldGVDYXJkID0gaGFuZGxlRGVsZXRlQ2FyZDtcbiAgfVxuXG4gIF9zZXRFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudFxuICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuaGFuZGxlRGVsZXRlQ2FyZCh0aGlzKTtcbiAgICAgIH0pO1xuICAgIHRoaXMuX2NhcmRFbGVtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2hhbmRsZUltYWdlUHJldmlldyh0aGlzLl9uYW1lLCB0aGlzLl9saW5rKTtcbiAgICAgIH0pO1xuICAgIHRoaXMuX2NhcmRFbGVtZW50XG4gICAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKVxuICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgICAgIHRoaXMuX2hhbmRsZUxpa2VJY29uKHRoaXMpO1xuICAgICAgfSk7XG4gIH1cblxuICBfaGFuZGxlTGlrZUljb24oKSB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpXG4gICAgICAuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgfVxuXG4gIF9yZW5kZXJMaWtlcygpIHtcbiAgICBpZiAodGhpcy5faXNMaWtlZCkge1xuICAgICAgdGhpcy5fbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9saWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlTGlrZShpc0xpa2VkKSB7XG4gICAgdGhpcy5faXNMaWtlZCA9IGlzTGlrZWQ7XG4gICAgdGhpcy5fcmVuZGVyTGlrZXMoKTtcbiAgfVxuXG4gIGdldENhcmRJZCgpIHtcbiAgICByZXR1cm4gdGhpcy5pZDtcbiAgfVxuXG4gIGdldElzTGlrZWQoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2lzTGlrZWQ7XG4gIH1cblxuICByZW1vdmUoKSB7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQucmVtb3ZlKCk7XG4gICAgdGhpcy5fY2FyZEVsZW1lbnQgPSBudWxsO1xuICB9XG5cbiAgX2hhbmRsZUltYWdlUHJldmlldygpIHtcbiAgICB0aGlzLl9oYW5kbGVJbWFnZUNsaWNrKHRoaXMuX25hbWUsIHRoaXMuX2xpbmspO1xuICB9XG5cbiAgZ2V0VmlldygpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IGRvY3VtZW50XG4gICAgICAucXVlcnlTZWxlY3Rvcih0aGlzLl9jYXJkU2VsZWN0b3IpXG4gICAgICAuY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIilcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgdGhpcy5fbGlrZUJ1dHRvbiA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idXR0b25cIik7XG4gICAgdGhpcy5fY2FyZEltYWdlRWxlbWVudCA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gICAgdGhpcy5fY2FyZFRpdGxlRWxlbWVudCA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gICAgdGhpcy5fY2FyZEltYWdlRWxlbWVudC5zcmMgPSB0aGlzLl9saW5rO1xuICAgIHRoaXMuX2NhcmRJbWFnZUVsZW1lbnQuYWx0ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9jYXJkVGl0bGVFbGVtZW50LnRleHRDb250ZW50ID0gdGhpcy5fbmFtZTtcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX3JlbmRlckxpa2VzKHRoaXMuX2lzTGlrZWQpO1xuICAgIHJldHVybiB0aGlzLl9jYXJkRWxlbWVudDtcbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IgfSkge1xuICAgIHRoaXMuX3BvcHVwRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2VcIik7XG4gICAgdGhpcy5faGFuZGxlRXNjQ2xvc2UgPSB0aGlzLl9oYW5kbGVFc2NDbG9zZS5iaW5kKHRoaXMpO1xuICB9XG5cbiAgb3BlbigpIHtcbiAgICAvLyBvcGVucyBwb3B1cFxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIC8vIGNsb3NlcyBwb3B1cFxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuXG4gIF9oYW5kbGVFc2NDbG9zZShlKSB7XG4gICAgLy8gbGlzdGVucyBmb3IgZXNjIGJ1dHRvblxuICAgIGlmIChlLmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIC8vIHNldHMgZXZlbnQgbGlzdGVuZXJzXG4gICAgdGhpcy5fY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHRoaXMuY2xvc2UoKSk7XG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgaWYgKGUudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsX29wZW5lZFwiKSkge1xuICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IoeyBwb3B1cFNlbGVjdG9yLCBoYW5kbGVGb3JtU3VibWl0IH0pIHtcbiAgICBzdXBlcih7IHBvcHVwU2VsZWN0b3IgfSk7XG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fcG9wdXBGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvblwiKTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25UZXh0ID0gdGhpcy5fc3VibWl0QnV0dG9uLnRleHRDb250ZW50O1xuICAgIHRoaXMuX2lucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgICB0aGlzLl9wb3B1cEZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbF9faW5wdXRcIilcbiAgICApO1xuICB9XG5cbiAgX2dldElucHV0VmFsdWVzKCkge1xuICAgIHRoaXMuX3BvcHVwRm9ybVZhbHVlcyA9IHt9O1xuICAgIHRoaXMuX2lucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgdGhpcy5fcG9wdXBGb3JtVmFsdWVzW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXMuX3BvcHVwRm9ybVZhbHVlcztcbiAgfVxuXG4gIHNldElucHV0VmFsdWVzKGRhdGEpIHtcbiAgICB0aGlzLl9pbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGlucHV0LnZhbHVlID0gZGF0YVtpbnB1dC5uYW1lXTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQodGhpcy5fZ2V0SW5wdXRWYWx1ZXMoKSk7XG4gICAgICB0aGlzLl9wb3B1cEZvcm0ucmVzZXQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlckxvYWRpbmdUZXh0KGlzTG9hZGluZywgdGV4dCA9IFwiU2F2aW5nLi4uXCIpIHtcbiAgICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSB0aGlzLl9zdWJtaXRCdXR0b25UZXh0O1xuICAgIH1cbiAgfVxufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgU2VjdGlvbiB7XG4gIGNvbnN0cnVjdG9yKHsgaXRlbXMsIHJlbmRlcmVyIH0sIGNvbnRhaW5lclNlbGVjdG9yKSB7XG4gICAgdGhpcy5faXRlbXMgPSBpdGVtcztcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIHRoaXMuX2NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoY29udGFpbmVyU2VsZWN0b3IpO1xuICB9XG5cbiAgcmVuZGVySXRlbXMoKSB7XG4gICAgLy8gUmVuZGVyIGFsbCBlbGVtZW50cyBvbiB0aGUgcGFnZS4gSXRlcmF0ZSB0aHJvdWdoIGl0ZW1zIGFycmF5IGFuZCBjYWxsIHRoZSByZW5kZXJlciBmdW5jdGlvbiBvbiBlYWNoIGl0ZW0uIFRoaXMgc2hvdWxkIGJlIGNhbGxlZCBvbmNlIG9uIHBhZ2UgbG9hZC5cbiAgICB0aGlzLl9pdGVtcy5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgICB0aGlzLl9yZW5kZXJlcihpdGVtKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFkZEl0ZW0oY2FyZEVsZW1lbnQpIHtcbiAgICAvLyB0YWtlcyBhIERPTSBlbGVtZW50IGFuZCBhZGRzIGl0IHRvIHRoZSBjb250YWluZXIuIFNob3VsZCBiZSBjYWxsZWQgd2hlbiBhZGRpbmcgYW4gaW5kaXZpZHVhbCBjYXJkIHRvIHRoZSBET00uXG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICB9XG59XG4iLCJleHBvcnQgY29uc3QgaW5pdGlhbENhcmRzID0gW1xuICB7XG4gICAgbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QveW9zZW1pdGUuanBnXCIsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIkxha2UgTG91aXNlXCIsXG4gICAgbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xha2UtbG91aXNlLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJCYWxkIE1vdW50YWluc1wiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9iYWxkLW1vdW50YWlucy5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGF0ZW1hclwiLFxuICAgIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYXRlbWFyLmpwZ1wiLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvdmFub2lzZS5qcGdcIixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiTGFnbyBkaSBCcmFpZXNcIixcbiAgICBsaW5rOiBcImh0dHBzOi8vcHJhY3RpY3VtLWNvbnRlbnQuczMudXMtd2VzdC0xLmFtYXpvbmF3cy5jb20vc29mdHdhcmUtZW5naW5lZXIvYXJvdW5kLXByb2plY3QvbGFnby5qcGdcIixcbiAgfSxcbl07XG5cbmV4cG9ydCBjb25zdCBmb3JtVmFsaWRhdGlvbkNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19idXR0b25cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fYnV0dG9uX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvcl92aXNpYmxlXCIsXG59O1xuIiwiaW1wb3J0IEZvcm1WYWxpZGF0b3IgZnJvbSBcIi4uL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qc1wiO1xuaW1wb3J0IENhcmQgZnJvbSBcIi4uL2NvbXBvbmVudHMvQ2FyZC5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEZvcm0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoRm9ybS5qc1wiO1xuaW1wb3J0IFBvcHVwV2l0aEltYWdlIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzXCI7XG5pbXBvcnQgUG9wdXBDb25maXJtRGVsZXRpb24gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBDb25maXJtRGVsZXRpb24uanNcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCB7IGZvcm1WYWxpZGF0aW9uQ29uZmlnIH0gZnJvbSBcIi4uL3V0aWxzL3V0aWxzLmpzXCI7XG5pbXBvcnQgVXNlckluZm8gZnJvbSBcIi4uL2NvbXBvbmVudHMvVXNlckluZm8uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL2NvbXBvbmVudHMvQXBpLmpzXCI7XG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuXG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiKTtcbmNvbnN0IGFkZENhcmRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkLWNhcmQtbW9kYWxcIik7XG5jb25zdCBjaGFuZ2VBdml0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XG5cbmNvbnN0IHByb2ZpbGVUaXRsZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLXRpdGxlLWlucHV0XCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5jb25zdCBwcm9maWxlRWRpdEZvcm0gPSBwcm9maWxlRWRpdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBhZGRDYXJkRm9ybSA9IGFkZENhcmRNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgYWRkTmV3Q2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKTtcbmNvbnN0IGVkaXRBdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idXR0b25cIik7XG5jb25zdCBhdmF0YXJGb3JtRWxlbWVudCA9IGNoYW5nZUF2aXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5cbmZ1bmN0aW9uIGhhbmRsZUltYWdlQ2xpY2sobmFtZSwgbGluaykge1xuICBwcmV2aWV3SW1hZ2VQb3B1cC5vcGVuKG5hbWUsIGxpbmspO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdCh1c2VyRGF0YSkge1xuICBlZGl0UHJvZmlsZVBvcHVwLnJlbmRlckxvYWRpbmdUZXh0KHRydWUpO1xuICBhcGlcbiAgICAudXBkYXRlVXNlckluZm8odXNlckRhdGEpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oe1xuICAgICAgICB0aXRsZTogcmVzLm5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiByZXMuYWJvdXQsXG4gICAgICB9KTtcbiAgICAgIGVkaXRQcm9maWxlUG9wdXAuY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBlZGl0UHJvZmlsZVBvcHVwLnJlbmRlckxvYWRpbmdUZXh0KGZhbHNlKTtcbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlQXZhdGFyU3VibWl0KGxpbmspIHtcbiAgZWRpdEF2YXRhclBvcHVwLnJlbmRlckxvYWRpbmdUZXh0KHRydWUpO1xuICBhcGlcbiAgICAudXBkYXRlQXZhdGFyKGxpbmspXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdXNlckluZm8udXBkYXRlQXZhdGFyKHJlcy5hdmF0YXIpO1xuICAgICAgZWRpdEF2YXRhclBvcHVwLmNsb3NlKCk7XG4gICAgICBhdmF0YXJGb3JtRWxlbWVudC5yZXNldCgpO1xuICAgICAgYXZhdGFyRm9ybVZhbGlkYXRvci5fZGlzYWJsZUJ1dHRvbigpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyBhdmF0YXJcIiwgZXJyKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIGVkaXRBdmF0YXJQb3B1cC5yZW5kZXJMb2FkaW5nVGV4dChmYWxzZSk7XG4gICAgfSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUFkZENhcmRTdWJtaXQoZGF0YSkge1xuICAvLyBjb25zb2xlLmxvZyhkYXRhKTtcbiAgbmV3Q2FyZFBvcHVwLnJlbmRlckxvYWRpbmdUZXh0KHRydWUpO1xuICBhcGlcbiAgICAuYWRkQ2FyZCh7XG4gICAgICBuYW1lOiBkYXRhLm5hbWUsXG4gICAgICBsaW5rOiBkYXRhLmxpbmssXG4gICAgICBfaWQ6IGRhdGEuaWQsXG4gICAgICBpc0xpa2VkOiBkYXRhLmlzTGlrZWQsXG4gICAgfSlcbiAgICAudGhlbigoY2FyZERhdGEpID0+IHtcbiAgICAgIHJlbmRlckNhcmQoY2FyZERhdGEpO1xuICAgICAgbmV3Q2FyZFBvcHVwLmNsb3NlKCk7XG4gICAgICBhZGRDYXJkRm9ybS5yZXNldCgpO1xuICAgICAgYWRkQ2FyZEZvcm1WYWxpZGF0b3IuX2Rpc2FibGVCdXR0b24oKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB3aGlsZSBhZGRpbmcgY2FyZFwiLCBlcnJvcik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBuZXdDYXJkUG9wdXAucmVuZGVyTG9hZGluZ1RleHQoZmFsc2UpO1xuICAgIH0pO1xufVxuXG5lZGl0QXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBlZGl0QXZhdGFyUG9wdXAub3BlbigpKTtcblxucHJvZmlsZUVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY29uc3QgZGF0YSA9IHVzZXJJbmZvLmdldFVzZXJJbmZvKCk7XG4gIHByb2ZpbGVUaXRsZUlucHV0LnZhbHVlID0gZGF0YS5uYW1lO1xuICBwcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZSA9IGRhdGEuZGVzY3JpcHRpb247XG4gIGVkaXRQcm9maWxlUG9wdXAub3BlbigpO1xufSk7XG5cbmFkZE5ld0NhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG5ld0NhcmRQb3B1cC5vcGVuKCkpO1xuXG5jb25zdCB1c2VySW5mbyA9IG5ldyBVc2VySW5mbyh7XG4gIG5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9fdGl0bGVcIixcbiAgam9iU2VsZWN0b3I6IFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIsXG4gIGF2YXRhclNlbGVjdG9yOiBcIi5wcm9maWxlX19pbWFnZVwiLFxufSk7XG5cbi8vIEFQSVxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiNmYwN2NiMzctZTlhOC00ZjE5LWFkN2UtZTMzZWQ3YjU4NTgwXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxubGV0IHNlY3Rpb247XG5cbmFwaVxuICAuZ2V0QWxsRGF0YSgpXG4gIC50aGVuKChbaW5pdGlhbENhcmRzLCB1c2VyRGF0YV0pID0+IHtcbiAgICB1c2VySW5mby51cGRhdGVBdmF0YXIodXNlckRhdGEuYXZhdGFyKTtcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7XG4gICAgICB0aXRsZTogdXNlckRhdGEubmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiB1c2VyRGF0YS5hYm91dCxcbiAgICB9KTtcbiAgICBzZWN0aW9uID0gbmV3IFNlY3Rpb24oXG4gICAgICB7XG4gICAgICAgIGl0ZW1zOiBpbml0aWFsQ2FyZHMsXG4gICAgICAgIHJlbmRlcmVyOiByZW5kZXJDYXJkLFxuICAgICAgfSxcbiAgICAgIFwiLmNhcmRzX19saXN0XCJcbiAgICApO1xuICAgIHNlY3Rpb24ucmVuZGVySXRlbXMoKTtcbiAgfSlcbiAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSk7XG5cbi8vIEZvcm0gVmFsaWRhdGlvblxuY29uc3QgYWRkQ2FyZEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcbiAgZm9ybVZhbGlkYXRpb25Db25maWcsXG4gIGFkZENhcmRGb3JtXG4pO1xuYWRkQ2FyZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuXG5jb25zdCBlZGl0UHJvZmlsZUZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcbiAgZm9ybVZhbGlkYXRpb25Db25maWcsXG4gIHByb2ZpbGVFZGl0Rm9ybVxuKTtcbmVkaXRQcm9maWxlRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbmNvbnN0IGF2YXRhckZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihcbiAgZm9ybVZhbGlkYXRpb25Db25maWcsXG4gIGF2YXRhckZvcm1FbGVtZW50XG4pO1xuYXZhdGFyRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XG5cbi8vIENhcmRzXG5mdW5jdGlvbiBjcmVhdGVDYXJkKGNhcmREYXRhKSB7XG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcbiAgICBjYXJkRGF0YSxcbiAgICBcIiNjYXJkLXRlbXBsYXRlXCIsXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcbiAgICBoYW5kbGVMaWtlSWNvbixcbiAgICBoYW5kbGVEZWxldGVDYXJkXG4gICk7XG4gIHJldHVybiBjYXJkLmdldFZpZXcoKTtcbn1cblxuY29uc3QgcmVuZGVyQ2FyZCA9IChjYXJkRGF0YSkgPT4ge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNyZWF0ZUNhcmQoY2FyZERhdGEpO1xuICBzZWN0aW9uLmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xufTtcblxuLy8gaGFuZGxlIExpa2UgSWNvblxuZnVuY3Rpb24gaGFuZGxlTGlrZUljb24oY2FyZCkge1xuICBpZiAoY2FyZC5nZXRJc0xpa2VkKCkpIHtcbiAgICBhcGlcbiAgICAgIC5yZW1vdmVMaWtlKGNhcmQuZ2V0Q2FyZElkKCkpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGNhcmQuaGFuZGxlTGlrZShmYWxzZSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgYXBpXG4gICAgICAuYWRkTGlrZShjYXJkLmdldENhcmRJZCgpKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjYXJkLmhhbmRsZUxpa2UodHJ1ZSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSk7XG4gIH1cbn1cblxuLy8gaGFuZGxlIGRlbGV0aW5nIGNhcmRzXG5mdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKGNhcmQpIHtcbiAgY29uZmlybURlbGV0aW9uUG9wdXAub3BlbigpO1xuICBjb25maXJtRGVsZXRpb25Qb3B1cC5jb25maXJtRGVsZXRpb24oKCkgPT4ge1xuICAgIGFwaVxuICAgICAgLmRlbGV0ZUNhcmQoY2FyZC5nZXRDYXJkSWQoKSlcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICBjYXJkLnJlbW92ZSgpO1xuICAgICAgICBjb25maXJtRGVsZXRpb25Qb3B1cC5jbG9zZSgpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkZWxldGluZyBjYXJkXCIsIGVycik7XG4gICAgICB9KTtcbiAgfSk7XG59XG5cbi8vIEluc3RhY2Ugb2YgU2VjdGlvbiBjbGFzc1xuXG4vLyBjb25zdCBzZWN0aW9uID0gbmV3IFNlY3Rpb24oXG4vLyAgIHsgaXRlbXM6IGluaXRpYWxDYXJkcywgcmVuZGVyZXI6IHJlbmRlckNhcmQgfSxcbi8vICAgXCIuY2FyZHNfX2xpc3RcIlxuLy8gKTtcbi8vIHNlY3Rpb24ucmVuZGVySXRlbXMoKTtcblxuLy8gUG9wdXBzXG5cbmNvbnN0IG5ld0NhcmRQb3B1cCA9IG5ldyBQb3B1cFdpdGhGb3JtKHtcbiAgcG9wdXBTZWxlY3RvcjogXCIjYWRkLWNhcmQtbW9kYWxcIixcbiAgaGFuZGxlRm9ybVN1Ym1pdDogaGFuZGxlQWRkQ2FyZFN1Ym1pdCxcbn0pO1xubmV3Q2FyZFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IGVkaXRQcm9maWxlUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gIHBvcHVwU2VsZWN0b3I6IFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiLFxuICBoYW5kbGVGb3JtU3VibWl0OiBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdCxcbn0pO1xuZWRpdFByb2ZpbGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBlZGl0QXZhdGFyUG9wdXAgPSBuZXcgUG9wdXBXaXRoRm9ybSh7XG4gIHBvcHVwU2VsZWN0b3I6IFwiI2VkaXQtYXZhdGFyLW1vZGFsXCIsXG4gIGhhbmRsZUZvcm1TdWJtaXQ6IGhhbmRsZUF2YXRhclN1Ym1pdCxcbn0pO1xuZWRpdEF2YXRhclBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmNvbnN0IHByZXZpZXdJbWFnZVBvcHVwID0gbmV3IFBvcHVwV2l0aEltYWdlKHtcbiAgcG9wdXBTZWxlY3RvcjogXCIjcHJldmlldy1pbWFnZS1tb2RhbFwiLFxufSk7XG5wcmV2aWV3SW1hZ2VQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBjb25maXJtRGVsZXRpb25Qb3B1cCA9IG5ldyBQb3B1cENvbmZpcm1EZWxldGlvbih7XG4gIHBvcHVwU2VsZWN0b3I6IFwiI3JlbW92ZS1jYXJkLW1vZGFsXCIsXG4gIGhhbmRsZUZvcm1TdWJtaXQ6ICgpID0+IHt9LFxufSk7XG5jb25maXJtRGVsZXRpb25Qb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgVXNlckluZm8ge1xuICBjb25zdHJ1Y3Rvcih7IG5hbWVTZWxlY3Rvciwgam9iU2VsZWN0b3IsIGF2YXRhclNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9uYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lU2VsZWN0b3IpO1xuICAgIHRoaXMuX2pvYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Ioam9iU2VsZWN0b3IpO1xuICAgIHRoaXMuX2F2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyU2VsZWN0b3IpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHRoaXMuX25hbWUudGV4dENvbnRlbnQsXG4gICAgICBkZXNjcmlwdGlvbjogdGhpcy5fam9iLnRleHRDb250ZW50LFxuICAgICAgYXZhdGFyOiB0aGlzLl9hdmF0YXIuc3JjLFxuICAgIH07XG4gIH1cblxuICBzZXRVc2VySW5mbyhkYXRhKSB7XG4gICAgdGhpcy5fbmFtZS50ZXh0Q29udGVudCA9IGRhdGEudGl0bGU7XG4gICAgdGhpcy5fam9iLnRleHRDb250ZW50ID0gZGF0YS5kZXNjcmlwdGlvbjtcbiAgfVxuXG4gIHVwZGF0ZUF2YXRhcihhdmF0YXIpIHtcbiAgICB0aGlzLl9hdmF0YXIuc3JjID0gYXZhdGFyO1xuICB9XG59IiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9oYW5kbGVQcm9taXNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yOiAke3Jlcy5zdGF0dXN9YCk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVByb21pc2UpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVByb21pc2UpO1xuICB9XG5cbiAgZ2V0QWxsRGF0YSgpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xuICB9XG5cbiAgdXBkYXRlVXNlckluZm8odXNlckRhdGEpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWU6IHVzZXJEYXRhLnRpdGxlLFxuICAgICAgICBhYm91dDogdXNlckRhdGEuZGVzY3JpcHRpb24sXG4gICAgICB9KSxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVByb21pc2UpO1xuICB9XG5cbiAgdXBkYXRlQXZhdGFyKGxpbmspIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkobGluayksXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVQcm9taXNlKTtcbiAgfVxuXG4gIGFkZExpa2UoSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlUHJvbWlzZSk7XG4gIH1cblxuICByZW1vdmVMaWtlKElkKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7SWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVByb21pc2UpO1xuICB9XG5cbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmssIF9pZCwgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBsaW5rLCBfaWQgfSksXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVQcm9taXNlKTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtJZH1gLCB7XG4gICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlUHJvbWlzZSk7XG4gIH1cbn1cbiIsImltcG9ydCBQb3B1cCBmcm9tIFwiLi9Qb3B1cC5qc1wiO1xyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IgfSkge1xyXG4gICAgc3VwZXIoeyBwb3B1cFNlbGVjdG9yIH0pO1xyXG4gICAgdGhpcy5faW1hZ2UgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FyZC1pbWFnZVwiKTtcclxuICAgIHRoaXMuX3RpdGxlID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcmQtdGl0bGVcIik7XHJcbiAgfVxyXG5cclxuICBvcGVuKG5hbWUsIGxpbmspIHtcclxuICAgIHRoaXMuX3RpdGxlLnRleHRDb250ZW50ID0gbmFtZTtcclxuICAgIHRoaXMuX2ltYWdlLmFsdCA9IG5hbWU7XHJcbiAgICB0aGlzLl9pbWFnZS5zcmMgPSBsaW5rO1xyXG4gICAgc3VwZXIub3BlbigpO1xyXG4gIH1cclxufVxyXG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXBcIjtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwQ29uZmlybURlbGV0aW9uIGV4dGVuZHMgUG9wdXAge1xuICBjb25zdHJ1Y3Rvcih7IHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQgfSkge1xuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gaGFuZGxlRm9ybVN1Ym1pdDtcbiAgICB0aGlzLl9wb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IocG9wdXBTZWxlY3Rvcik7XG4gICAgdGhpcy5fZGVsZXRlQnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5jYXJkX19kZWxldGUtYnV0dG9uXCJcbiAgICApO1xuICAgIHRoaXMuX2lzU3VibWl0dGVkID0gZmFsc2U7XG4gICAgdGhpcy5fY2FyZElkID0gbnVsbDtcbiAgICB0aGlzLl9jYXJkID0gbnVsbDtcbiAgfVxuXG4gIG9wZW4oY2FyZCwgY2FyZElkKSB7XG4gICAgdGhpcy5fY2FyZCA9IGNhcmQ7XG4gICAgdGhpcy5fY2FyZElkID0gY2FyZElkO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxuXG4gIGdldElzU3VibWl0dGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9pc1N1Ym1pdHRlZDtcbiAgfVxuXG4gIGNvbmZpcm1EZWxldGlvbihhcGkpIHtcbiAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0ID0gYXBpO1xuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdGhpcy5faXNTdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCh0aGlzLl9jYXJkLCB0aGlzLl9jYXJkSWQpO1xuICAgIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiRm9ybVZhbGlkYXRvciIsImNvbnN0cnVjdG9yIiwiY29uZmlnIiwiZm9ybUVsZW1lbnQiLCJ0aGlzIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm1FbGVtZW50IiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbGVtZW50IiwiZXJyb3JNZXNzYWdlRWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsImNsYXNzTGlzdCIsImFkZCIsInRleHRDb250ZW50IiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJfaGlkZUlucHV0RXJyb3IiLCJyZW1vdmUiLCJfY2hlY2tJbnB1dFZhbGlkaXR5IiwidmFsaWRpdHkiLCJ2YWxpZCIsIl90b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0RWxlbWVudHMiLCJfaGFzSW52YWxpZElucHV0IiwiX2Rpc2FibGVCdXR0b24iLCJfZW5hYmxlQnV0dG9uIiwic29tZSIsIl9zZXRFdmVudExpc3RlbmVycyIsIkFycmF5IiwiZnJvbSIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJfc3VibWl0QnV0dG9uIiwiZm9yRWFjaCIsImFkZEV2ZW50TGlzdGVuZXIiLCJkaXNhYmxlZCIsImVuYWJsZVZhbGlkYXRpb24iLCJlIiwicHJldmVudERlZmF1bHQiLCJDYXJkIiwiZGF0YSIsImNhcmRTZWxlY3RvciIsImhhbmRsZUltYWdlQ2xpY2siLCJoYW5kbGVMaWtlSWNvbiIsImhhbmRsZURlbGV0ZUNhcmQiLCJfbmFtZSIsIm5hbWUiLCJfbGluayIsImxpbmsiLCJfaWQiLCJfaXNMaWtlZCIsImlzTGlrZWQiLCJfY2FyZFNlbGVjdG9yIiwiX2hhbmRsZUltYWdlQ2xpY2siLCJfaGFuZGxlTGlrZUljb24iLCJfY2FyZEVsZW1lbnQiLCJfaGFuZGxlSW1hZ2VQcmV2aWV3IiwidG9nZ2xlIiwiX3JlbmRlckxpa2VzIiwiX2xpa2VCdXR0b24iLCJoYW5kbGVMaWtlIiwiZ2V0Q2FyZElkIiwiZ2V0SXNMaWtlZCIsImdldFZpZXciLCJkb2N1bWVudCIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfY2FyZEltYWdlRWxlbWVudCIsIl9jYXJkVGl0bGVFbGVtZW50Iiwic3JjIiwiYWx0IiwiUG9wdXAiLCJfcmVmIiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cEVsZW1lbnQiLCJfY2xvc2VCdXR0b24iLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwidGFyZ2V0IiwiY29udGFpbnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX3BvcHVwRm9ybSIsIl9oYW5kbGVGb3JtU3VibWl0IiwiX3N1Ym1pdEJ1dHRvblRleHQiLCJfaW5wdXRMaXN0IiwiX2dldElucHV0VmFsdWVzIiwiX3BvcHVwRm9ybVZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJzZXRJbnB1dFZhbHVlcyIsInJlc2V0IiwicmVuZGVyTG9hZGluZ1RleHQiLCJpc0xvYWRpbmciLCJ0ZXh0IiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiU2VjdGlvbiIsImNvbnRhaW5lclNlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwiY2FyZEVsZW1lbnQiLCJwcmVwZW5kIiwiZm9ybVZhbGlkYXRpb25Db25maWciLCJmb3JtU2VsZWN0b3IiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInByb2ZpbGVFZGl0TW9kYWwiLCJhZGRDYXJkTW9kYWwiLCJjaGFuZ2VBdml0YXJNb2RhbCIsInByb2ZpbGVUaXRsZUlucHV0IiwicHJvZmlsZURlc2NyaXB0aW9uSW5wdXQiLCJwcm9maWxlRWRpdEZvcm0iLCJhZGRDYXJkRm9ybSIsImFkZE5ld0NhcmRCdXR0b24iLCJlZGl0QXZhdGFyQnV0dG9uIiwiYXZhdGFyRm9ybUVsZW1lbnQiLCJwcmV2aWV3SW1hZ2VQb3B1cCIsImVkaXRBdmF0YXJQb3B1cCIsInVzZXJJbmZvIiwiZ2V0VXNlckluZm8iLCJkZXNjcmlwdGlvbiIsImVkaXRQcm9maWxlUG9wdXAiLCJuZXdDYXJkUG9wdXAiLCJuYW1lU2VsZWN0b3IiLCJqb2JTZWxlY3RvciIsImF2YXRhclNlbGVjdG9yIiwiX2pvYiIsIl9hdmF0YXIiLCJhdmF0YXIiLCJzZXRVc2VySW5mbyIsInRpdGxlIiwidXBkYXRlQXZhdGFyIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2hhbmRsZVByb21pc2UiLCJyZXMiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0SW5pdGlhbENhcmRzIiwiZmV0Y2giLCJ0aGVuIiwiZ2V0QWxsRGF0YSIsImFsbCIsInVwZGF0ZVVzZXJJbmZvIiwidXNlckRhdGEiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImFib3V0IiwiYWRkTGlrZSIsIklkIiwicmVtb3ZlTGlrZSIsImFkZENhcmQiLCJfcmVmMiIsImRlbGV0ZUNhcmQiLCJhdXRob3JpemF0aW9uIiwic2VjdGlvbiIsImluaXRpYWxDYXJkcyIsInJlbmRlckNhcmQiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImFkZENhcmRGb3JtVmFsaWRhdG9yIiwiYXZhdGFyRm9ybVZhbGlkYXRvciIsImNhcmREYXRhIiwiY3JlYXRlQ2FyZCIsImNhcmQiLCJjb25maXJtRGVsZXRpb25Qb3B1cCIsImNvbmZpcm1EZWxldGlvbiIsImZpbmFsbHkiLCJfaW1hZ2UiLCJfdGl0bGUiLCJfcG9wdXAiLCJfZGVsZXRlQnV0dG9uIiwiX2lzU3VibWl0dGVkIiwiX2NhcmRJZCIsIl9jYXJkIiwiY2FyZElkIiwiZ2V0SXNTdWJtaXR0ZWQiLCJldnQiXSwic291cmNlUm9vdCI6IiJ9